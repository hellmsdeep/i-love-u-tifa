<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Pedido especial • Tifa</title>

<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@600&family=Inter:wght@300;500;700;800&display=swap" rel="stylesheet">

<style>
  :root{
    --bg-overlay: rgba(0,0,0,0.08);
    --purple-1: #7c3aed;
    --purple-2: #9f7bff;
    --accent: #ff4d6d;
    --glass: rgba(255,255,255,0.03);
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial;background:#000;color:#fff}
  body{display:flex;align-items:center;justify-content:center;overflow:hidden}

  /* full-bleed background */
  .stage{
    position:fixed;inset:0;
    background-image:url('https://i.pinimg.com/736x/ea/58/b9/ea58b92372ca0cd6d366aa2984765096.jpg');
    background-size:cover;background-position:center center;
    filter:contrast(1.04) saturate(1.03);
    transition:transform .12s linear;
    will-change:transform;
    z-index:0;
  }
  .stage::after{ content:""; position:absolute; inset:0; background:linear-gradient(180deg, rgba(0,0,0,0.02), rgba(0,0,0,0.08)); }

  /* container */
  .wrap{
    position:relative; z-index:10;
    width:100%; max-width:900px;
    margin:28px; padding:28px;
    border-radius:18px;
    background: linear-gradient(180deg, rgba(0,0,0,0.08), rgba(0,0,0,0.02));
    backdrop-filter: blur(4px);
    box-shadow: 0 30px 90px rgba(0,0,0,0.7);
    display:flex;flex-direction:column;align-items:center;
  }

  header{ text-align:center; margin-bottom:6px; }
  header h1{ font-family:Cinzel, serif; font-size:34px; margin:0; color:#fff; text-shadow:0 10px 30px rgba(0,0,0,0.6); }
  header p{ margin:8px 0 0; font-size:18px; color:rgba(255,255,255,0.95) }

  /* button area */
  .actions{ width:100%; display:flex; justify-content:center; margin-top:18px; }
  .frame{
    width:360px; max-width:92vw;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border:1px solid rgba(255,255,255,0.04);
    border-radius:14px; padding:18px; position:relative;
  }

  .btn{
    width:100%; padding:14px 0; border-radius:12px; border:0; font-weight:800; font-size:18px;
    cursor:pointer; display:block; position:absolute; left:0; transition: transform .12s ease, box-shadow .12s ease;
  }

  #btn-yes{
    top:12px;
    background: linear-gradient(135deg, var(--purple-1), var(--purple-2));
    color:#fff;
    box-shadow:0 18px 48px rgba(124,58,237,0.22);
  }
  #btn-yes:active{ transform: translateY(2px); }

  #btn-no{
    top:86px;
    background: rgba(255,255,255,0.04);
    color:#fff;
    border:2px solid rgba(255,255,255,0.06);
  }

  /* small helper text removed as requested earlier */

  /* effects layer */
  .effects{ position:fixed; inset:0; pointer-events:none; z-index:40; overflow:hidden; }
  .heart{ position:absolute; width:14px; height:14px; transform:rotate(-45deg); }
  .heart:before,.heart:after{ content:''; position:absolute; width:14px; height:14px; border-radius:50%; background:linear-gradient(180deg,#ff9aa2,#ff4d6d); }
  .conf{ position:absolute; width:10px; height:12px; border-radius:3px; }

  /* modal */
  .overlay{ position:fixed; inset:0; display:flex; align-items:center; justify-content:center; opacity:0; pointer-events:none; transition:opacity .28s; z-index:50 }
  .overlay.show{ opacity:1; pointer-events:auto }
  .modal{ background:rgba(0,0,0,0.76); padding:20px 26px; border-radius:12px; border:1px solid rgba(255,255,255,0.04); text-align:center; max-width:90vw }
  .modal p{ margin:0; font-size:20px; font-weight:700; color:#fff; }

  /* toast for NO first click */
  .toast{ position:absolute; left:50%; transform:translateX(-50%) translateY(-8px); top:-38px; padding:8px 12px; border-radius:8px; background:rgba(0,0,0,0.7); color:#fff; font-weight:700; font-size:13px; opacity:0; pointer-events:none; transition:opacity .18s, transform .18s }
  .toast.show{ opacity:1; transform:translateX(-50%) translateY(-14px); }

  /* subtle mobile tweak */
  @media (max-width:520px){
    header h1{ font-size:26px; }
    .frame{ width:86vw; padding:12px; }
    #btn-yes,#btn-no{ font-size:16px; padding:12px 0; border-radius:10px; }
  }
</style>
</head>
<body>

  <div class="stage" id="stage" aria-hidden="true"></div>

  <div class="wrap" role="main" aria-labelledby="title">
    <header>
      <h1 id="title">Pedido especial</h1>
      <p>Tifa, <strong>você aceita namorar comigo?</strong></p>
    </header>

    <div class="actions">
      <div class="frame" id="frame">
        <button id="btn-yes" class="btn" aria-label="Sim" tabindex="0">SIM</button>
        <button id="btn-no" class="btn" aria-label="Não" tabindex="0">NÃO</button>
        <div class="toast" id="no-toast" role="status" aria-hidden="true">pensa melhor</div>
      </div>
    </div>
  </div>

  <div class="overlay" id="overlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true">
      <p id="love">ebaeba eu te amo, meu amor!</p>
    </div>
  </div>

  <div class="effects" id="effects" aria-hidden="true"></div>

  <!-- Primary audio (local MP3) - please upload sienna.mp3 into same folder -->
  <audio id="audio" preload="auto" loop playsinline>
    <source src="sienna.mp3" type="audio/mpeg">
  </audio>

<script>
/* ------------- Robust interactive logic (integrated features) ------------- */
/* Features included:
   - button NO flees when mouse/touch approaches (like initial request);
   - button SIM triggers celebration: modal, hearts, confetti, audio with fade-in;
   - audio: local MP3 attempted; if blocked/fails -> try YouTube IFrame API fallback;
   - unlock audio on first pointer interaction (muted play trick);
   - keyboard accessibility; responsive behavior; small analytics stored in localStorage.
   - many safeguards to avoid race-conditions and ensure reliability.
*/

/* Element refs */
const stage = document.getElementById('stage');
const frame = document.getElementById('frame');
const btnYes = document.getElementById('btn-yes');
const btnNo  = document.getElementById('btn-no');
const noToast = document.getElementById('no-toast');
const overlay = document.getElementById('overlay');
const effects = document.getElementById('effects');
const audio = document.getElementById('audio');

/* State */
let audioUnlocked = false;
let celebrationRunning = false;
let noFirstClick = true;
let attempts = { noClicks:0, yesClicks:0 };
try { const s = localStorage.getItem('pedido_state'); if(s) { const st = JSON.parse(s); attempts = st.attempts || attempts; } } catch(e){}

/* Accessibility: focus outlines */
btnYes.addEventListener('focus', ()=> btnYes.style.boxShadow = '0 20px 60px rgba(124,58,237,0.3)');
btnYes.addEventListener('blur', ()=> btnYes.style.boxShadow = '');
btnNo.addEventListener('focus', ()=> btnNo.style.boxShadow = '0 10px 26px rgba(0,0,0,0.3)');
btnNo.addEventListener('blur', ()=> btnNo.style.boxShadow = '');

/* Parallax to highlight background */
function handleParallax(e){
  const client = (e.touches && e.touches[0]) ? e.touches[0] : e;
  const rx = (client.clientX / window.innerWidth - 0.5) * 8;
  const ry = (client.clientY / window.innerHeight - 0.5) * 6;
  stage.style.transform = `translate3d(${rx}px, ${ry}px, 0) scale(1.02)`;
}
window.addEventListener('mousemove', handleParallax);
window.addEventListener('touchmove', (e)=> { if(e.touches && e.touches[0]) handleParallax(e.touches[0]); }, {passive:true});

/* Layout helpers */
function ensureLayout(){
  const gap = 12;
  // buttons width equal
  btnYes.style.width = '100%';
  btnNo.style.width = '100%';
  // set top positions (stacked)
  btnYes.style.top = gap + 'px';
  btnNo.style.top = (btnYes.offsetHeight + gap*2) + 'px';
  // ensure frame height
  const needed = parseInt(btnNo.style.top) + btnNo.offsetHeight + gap;
  if(frame.clientHeight < needed) frame.style.height = (needed) + 'px';
  // position toast above NO
  const rect = btnNo.getBoundingClientRect();
  const parent = frame.getBoundingClientRect();
  noToast.style.left = (rect.left - parent.left + rect.width/2) + 'px';
  noToast.style.top = (rect.top - parent.top - 38) + 'px';
}
window.addEventListener('load', ()=> { ensureLayout(); setTimeout(()=>moveNoRandom(), 140); });
window.addEventListener('resize', ensureLayout);

/* ---------- BUTTON NO: Flee behavior ---------- */
/* The NO button will move away when the pointer gets close.
   Behavior:
   - On pointerenter or touchstart on the NO button, it will move to a new random Y
   - Ensure new position doesn't overlap the YES button (calculate rects)
   - Movement is smooth and bounded inside the frame
*/
function rectsOverlap(a, b){
  return !(a.right < b.left || a.left > b.right || a.bottom < b.top || a.top > b.bottom);
}

function moveNoRandom(){
  // compute frame bounds and allowed area
  const padding = 8;
  const frameRect = frame.getBoundingClientRect();
  const yesRect = btnYes.getBoundingClientRect();

  // vertical bounds inside frame relative to frame top
  const minY = btnYes.offsetHeight + padding*2;
  const maxY = Math.max(frame.clientHeight - btnNo.offsetHeight - padding, minY + 2);

  // pick positions until not overlapping yes rect
  let attemptsLocal = 0;
  let topCandidate = minY;
  while(attemptsLocal < 30){
    const y = Math.floor(Math.random() * (maxY - minY + 1)) + minY;
    // candidate rect relative to viewport
    const candRect = {
      left: frameRect.left,
      top: frameRect.top + y,
      right: frameRect.left + btnNo.offsetWidth,
      bottom: frameRect.top + y + btnNo.offsetHeight
    };
    if(!rectsOverlap(candRect, yesRect)) { topCandidate = y; break; }
    attemptsLocal++;
  }

  // horizontal jitter
  const jitter = Math.floor(Math.random() * 16 - 8);
  // set transform for smoother movement
  btnNo.style.transition = 'top .18s ease, transform .18s ease';
  btnNo.style.top = topCandidate + 'px';
  btnNo.style.transform = `translateX(${jitter}px)`;

  // clear transition after movement to avoid trapping
  setTimeout(()=>{ btnNo.style.transition = ''; }, 220);
}

/* Event listeners for NO: pointer enter, touchstart, click */
btnNo.addEventListener('pointerenter', (e) => {
  // flee
  moveNoRandom();
});
btnNo.addEventListener('touchstart', (e) => {
  e.preventDefault(); // ensure touch triggers our move
  moveNoRandom();
}, {passive:false});

/* On click: show toast first time, then visual shake on subsequent */
btnNo.addEventListener('click', (e) => {
  e.preventDefault();
  attempts.noClicks++;
  saveState();
  if(noFirstClick){
    noFirstClick = false;
    noToast.classList.add('show');
    noToast.setAttribute('aria-hidden','false');
    setTimeout(()=>{ noToast.classList.remove('show'); noToast.setAttribute('aria-hidden','true'); }, 1200);
  } else {
    // small shake feedback
    btnNo.classList.add('shake');
    setTimeout(()=> btnNo.classList.remove('shake'), 420);
  }
});

/* keyboard support */
btnNo.addEventListener('keydown', (e)=>{
  if(e.key === 'Enter' || e.key === ' '){
    e.preventDefault();
    btnNo.click();
  }
});

/* ---------- AUDIO: unlock + play + fallback ---------- */
/* Strategy:
   - On first pointerdown anywhere -> muted play to unlock audio (audioUnlocked)
   - When SIM clicked -> attempt play local MP3 (with fade-in)
   - If MP3 fails (network/blocked), load YouTube IFrame API and play muted autoplay then unmute
*/

function unlockAudioOnFirstTouch(){
  if(audioUnlocked) return;
  audioUnlocked = true;
  try{
    audio.muted = true;
    audio.play().then(()=>{ setTimeout(()=>{ audio.muted = false; }, 200); }).catch(()=>{ /* ignore */ });
  }catch(e){}
  document.removeEventListener('pointerdown', unlockAudioOnFirstTouch);
}
document.addEventListener('pointerdown', unlockAudioOnFirstTouch, {passive:true});

/* fade helper */
function fadeInAudio(duration = 1200){
  try{
    audio.volume = 0;
    let v = 0;
    const step = 0.05;
    const iv = setInterval(()=> {
      v = Math.min(1, v + step);
      audio.volume = v;
      if(v >= 1) clearInterval(iv);
    }, Math.max(10, Math.floor(duration * step)));
  }catch(e){}
}

/* YouTube fallback loader (muted play then try to unmute) */
let ytLoaded = false;
function loadYouTubeFallback(){
  if(ytLoaded) return;
  ytLoaded = true;
  const tag = document.createElement('script');
  tag.src = 'https://www.youtube.com/iframe_api';
  document.body.appendChild(tag);
  window.onYouTubeIframeAPIReady = function(){
    try{
      const container = document.createElement('div');
      container.style.display = 'none';
      document.body.appendChild(container);
      const player = new YT.Player(container, {
        height:'0', width:'0',
        videoId:'1rZJwZC9C3s',
        playerVars: { autoplay:1, loop:1, playlist:'1rZJwZC9C3s', controls:0, modestbranding:1, playsinline:1, rel:0 },
        events: {
          onReady: function(e){
            try{ e.target.mute(); e.target.playVideo(); setTimeout(()=>{ try{ e.target.unMute(); }catch(_){} }, 800); }catch(_){}
          }
        }
      });
    }catch(e){ console.warn('YT fallback failed', e); }
  };
}

/* Play audio with fallback */
async function tryPlayAudio(){
  try{
    audio.currentTime = 0;
    audio.volume = 0;
    await audio.play();
    fadeInAudio(1200);
    return true;
  }catch(err){
    // try muted-play unmute trick
    try{
      audio.muted = true;
      await audio.play();
      audio.muted = false;
      fadeInAudio(1200);
      return true;
    }catch(e){
      loadYouTubeFallback();
      return false;
    }
  }
}

/* ---------- CELEBRATION (SIM) ---------- */
function spawnHeartsFromElement(el, count){
  const rect = el.getBoundingClientRect();
  const cx = rect.left + rect.width/2;
  const cy = rect.top + rect.height/2;
  for(let i=0;i<count;i++){
    const h = document.createElement('div'); h.className = 'heart';
    effects.appendChild(h);
    const sx = cx + (Math.random()*100 - 50);
    const sy = cy + (Math.random()*30 - 10);
    h.style.left = sx + 'px';
    h.style.top = sy + 'px';
    const driftX = (Math.random()*300 - 150);
    const dur = 1200 + Math.random()*1600;
    h.animate([
      { transform:'translate3d(0,0,0) scale(.85)', opacity:1 },
      { transform:`translate3d(${driftX}px,-220%,0) scale(1.3)`, opacity:0 }
    ], { duration: dur, easing:'cubic-bezier(.15,.85,.15,1)' }).onfinish = ()=> h.remove();
  }
}
function spawnConfettiFromElement(el, n){
  const rect = el.getBoundingClientRect();
  const cx = rect.left + rect.width/2;
  const cy = rect.top + rect.height/2;
  const colors = ['#7c3aed','#9f7bff','#ff4d6d','#ffd166','#7bdff2'];
  for(let i=0;i<n;i++){
    const c = document.createElement('div'); c.className = 'conf';
    c.style.background = colors[Math.floor(Math.random()*colors.length)];
    effects.appendChild(c);
    c.style.left = (cx + (Math.random()*160 - 80)) + 'px';
    c.style.top = (cy + (Math.random()*12 - 6)) + 'px';
    const rot = Math.random()*360;
    const dur = 1600 + Math.random()*2000;
    c.animate([{ transform:`translateY(0) rotate(${rot}deg)`, opacity:1 }, { transform:`translateY(120vh) rotate(${rot+720}deg)`, opacity:0 }], { duration: dur, easing:'cubic-bezier(.2,.6,.2,1)' }).onfinish = ()=> c.remove();
  }
}

async function celebrate(){
  if(celebrationRunning) return;
  celebrationRunning = true;
  attempts.yesClicks++;
  saveState();
  // spawn waves
  spawnHeartsFromElement(btnYes, 70);
  spawnConfettiFromElement(btnYes, 100);
  setTimeout(()=> spawnHeartsFromElement(btnYes, 40), 250);
  setTimeout(()=> spawnConfettiFromElement(btnYes, 50), 480);

  // show modal text
  overlay.classList.add('show');
  overlay.setAttribute('aria-hidden','false');

  // try audio
  await tryPlayAudio();

  // enable more interactions after a short delay
  setTimeout(()=> { celebrationRunning = false; }, 1400);
}

/* SIM click handlers: pointerdown is best for latency */
btnYes.addEventListener('pointerdown', (e)=>{
  e.preventDefault();
  celebrate();
});
btnYes.addEventListener('keydown', (e)=>{
  if(e.key === 'Enter' || e.key === ' '){ e.preventDefault(); celebrate(); }
});

/* Close overlay on click anywhere in overlay */
overlay.addEventListener('pointerdown', ()=> {
  overlay.classList.remove('show');
  overlay.setAttribute('aria-hidden','true');
});

/* ---------- localStorage persistence ---------- */
function saveState(){
  try{
    localStorage.setItem('pedido_state', JSON.stringify({ attempts }));
  }catch(e){}
}

/* small HEAD check for local mp3 (optional) */
(function headCheck(){
  fetch('sienna.mp3', { method: 'HEAD' }).then(r=>{
    if(!r.ok) console.warn('sienna.mp3 parece não existir no servidor (HEAD ok=false).');
  }).catch(()=>{ /* ignore */ });
})();

/* End of script */
</script>

</body>
</html>
